<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Gábor Farkas | OpenLayers layer management</title>
  <meta name="description" content="My personal site.
">

  <link rel="shortcut icon" href="/assets/img/favicon.ico">

  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="canonical" href="/blog/2014/openlayers-layer-management/">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    
    <span class="site-title">
        
        Gábor Farkas
    </span>
    

    <nav class="site-nav">

      <div class="trigger">
        <!-- About -->
        <a class="page-link" href="/">about</a>

        <!-- Blog -->
        <a class="page-link" href="/blog/">blog</a>

        <!-- Pages -->
        
          
        
          
            <a class="page-link" href="/cv/">CV</a>
          
        
          
        
          
        
          
            <a class="page-link" href="/publications/">publications</a>
          
        
          
            <a class="page-link" href="/research/">stuff</a>
          
        
          
        
          
        
          
        

        <!-- CV link -->
        <!-- <a class="page-link" href="/assets/pdf/CV.pdf">vitae</a> -->

      </div>
    </nav>

  </div>

</header>



    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">OpenLayers layer management</h1>
    <p class="post-meta">November 27, 2014</p>
  </header>

  <article class="post-content">
    <style>
    svg {
        max-height: initial;
    }
</style>

<link href="/assets/css/ol-v3.0.0.css" rel="stylesheet" type="text/css" />

<p>In the previous post I wrote about layer creation. This is only a part of the capabilities of a good GIS application. A good application can also manage layers in an efficient way. Fortunately, OpenLayers libraries have predefined functions for layer management. They provide a great base to build upon and create dynamic Web GIS applications. Some of the basic tasks of layer management are adding and removing layers, changing layer order, listing rendered layers, and changing layer styles. Off course, they have to do it during the workflow, without reloading the page. I will show a few of these functions with a live example in this post.</p>

<h3 id="adding-layers">Adding layers</h3>

<p>To demonstrate layer management, first you have to add some layers to work with. In this example, I will use the base layer types, presented in the previous post:</p>

<p>OpenLayers 2:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">ol2_image</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Layer</span><span class="p">.</span><span class="nx">Image</span><span class="p">(</span>
    <span class="s1">'City Lights'</span><span class="p">,</span>
    <span class="s1">'http://dev.openlayers.org/examples/data/4_m_citylights_lg.gif'</span><span class="p">,</span>
    <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Bounds</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mf">88.759</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mf">88.759</span><span class="p">),</span>
    <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Size</span><span class="p">(</span><span class="mi">580</span><span class="p">,</span> <span class="mi">288</span><span class="p">),</span>
    <span class="p">{</span>
        <span class="na">numZoomLevels</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="na">isBaseLayer</span><span class="p">:</span> <span class="kc">false</span>
    <span class="p">});</span>

<span class="kd">var</span> <span class="nx">ol2_tile</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Layer</span><span class="p">.</span><span class="nx">WMS</span><span class="p">(</span>
    <span class="s1">'Global Imagery'</span><span class="p">,</span>
    <span class="s1">'http://demo.opengeo.org/geoserver/wms'</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="na">layers</span><span class="p">:</span> <span class="s1">'bluemarble'</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="na">buffer</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">});</span>

<span class="kd">var</span> <span class="nx">ol2_vector</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Layer</span><span class="p">.</span><span class="nx">Vector</span><span class="p">(</span><span class="s1">'Countries'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">projection</span><span class="p">:</span> <span class="s1">'EPSG:4326'</span><span class="p">,</span>
    <span class="na">strategies</span><span class="p">:</span> <span class="p">[</span><span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Strategy</span><span class="p">.</span><span class="nx">Fixed</span><span class="p">()],</span>
    <span class="na">protocol</span><span class="p">:</span> <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Protocol</span><span class="p">.</span><span class="nx">HTTP</span><span class="p">({</span>
        <span class="na">url</span><span class="p">:</span> <span class="s2">"countries.geojson"</span><span class="p">,</span>
        <span class="na">format</span><span class="p">:</span> <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">GeoJSON</span><span class="p">()</span>
    <span class="p">}),</span>
    <span class="na">style</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">strokeColor</span><span class="p">:</span> <span class="s1">'#339933'</span><span class="p">,</span>
        <span class="na">strokeWidth</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="na">strokeOpacity</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="na">fill</span><span class="p">:</span> <span class="kc">false</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">ol2_marker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Layer</span><span class="p">.</span><span class="nx">Markers</span><span class="p">(</span><span class="s1">'Random markers'</span><span class="p">);</span>
</code></pre>
</div>

<p>OpenLayers 3:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">ol3_tile</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">Tile</span><span class="p">({</span>
    <span class="na">source</span><span class="p">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">TileWMS</span><span class="p">({</span>
        <span class="na">url</span><span class="p">:</span> <span class="s1">'http://demo.opengeo.org/geoserver/wms'</span><span class="p">,</span>
        <span class="na">params</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">layers</span><span class="p">:</span> <span class="s1">'bluemarble'</span><span class="p">,</span>
            <span class="na">format</span><span class="p">:</span> <span class="s1">'image/png'</span>
        <span class="p">}</span>
    <span class="p">}),</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">ol3_heatmap</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">Heatmap</span><span class="p">({</span>
     <span class="na">source</span><span class="p">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">Vector</span><span class="p">(),</span>
     <span class="na">radius</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
     <span class="na">weight</span><span class="p">:</span> <span class="s1">'magnitude'</span><span class="p">,</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">ol3_image</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">Image</span><span class="p">({</span>
    <span class="na">source</span><span class="p">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">ImageStatic</span><span class="p">({</span>
        <span class="na">url</span><span class="p">:</span> <span class="s1">'http://dev.openlayers.org/examples/data/4_m_citylights_lg.gif'</span><span class="p">,</span>
        <span class="na">imageExtent</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mf">89.5</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mf">89.5</span><span class="p">],</span>
        <span class="na">imageSize</span><span class="p">:</span> <span class="p">[</span><span class="mi">580</span><span class="p">,</span> <span class="mi">288</span><span class="p">]</span>
    <span class="p">}),</span>
    <span class="na">minResolution</span><span class="p">:</span> <span class="mf">0.15625</span><span class="p">,</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">ol3_vector</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">Vector</span><span class="p">({</span>
    <span class="na">source</span><span class="p">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">GeoJSON</span><span class="p">({</span>
        <span class="na">url</span><span class="p">:</span> <span class="s1">'countries.geojson'</span>
    <span class="p">}),</span>
    <span class="na">style</span><span class="p">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">Style</span><span class="p">({</span>
        <span class="na">stroke</span><span class="p">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">Stroke</span><span class="p">({</span>
            <span class="na">color</span><span class="p">:</span> <span class="s1">'#339933'</span><span class="p">,</span>
            <span class="na">width</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="na">opacity</span><span class="p">:</span> <span class="mi">1</span>
        <span class="p">})</span>
    <span class="p">}),</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">ol3_group</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">Group</span><span class="p">();</span>
</code></pre>
</div>

<h3 id="layer-management">Layer management</h3>

<p>OpenLayers libraries provide functionality of modifying layers on some levels. OpenLayers 2 has a rich array of tools to achieve tasks of layer management. OpenLayers 3 doesn’t have so much helper functions, yet, but it has some essential basic functionality to build on. As layers are members of the map object, these functions have to be called from it. The only exception is setting the style of a layer (in this example opacity), which is a layer property, so it has to be called from the layer object.</p>

<p>OpenLayers 2:</p>

<div id="ol2map" style="height: 500px; width: 700px;"></div>
<table>
    <tbody>
        <tr>
            <td><select id="ol2_layerSelection" onchange="ol2_getAttributes(this.value)">
                        <option selected="" value="ol2_tile">Tile layer</option>
                        <option value="ol2_image">Image layer</option>
                        <option value="ol2_vector">Vector layer</option>
                        <option value="ol2_marker">Marker layer</option>
                    </select></td>
                    <td>Current pos.: <span id="ol2_pos"></span></td>
                    <td><input onclick="ol2_layerUp()" type="button" value="Up" /></td>
                    <td><input onclick="ol2_layerDown()" type="button" value="Down" /></td>
                    <td><input onclick="ol2_layerTop()" type="button" value="Top" /></td>
                    <td><input onclick="ol2_layerBottom()" type="button" value="Bottom" /></td>
                    <td><input onclick="ol2_layerAdd()" type="button" value="Add" /></td>
                    <td><input onclick="ol2_layerRemove()" type="button" value="Remove" /></td>
                </tr>
</tbody></table>
<table>
                <tbody>
<tr>
                    <td>Opacity(%):</td>
                    <td><input id="ol2_opacity" max="1" min="0" oninput="ol2_changeOpacity(this.value)" step="0.1" type="range" /></td>
                </tr>
</tbody></table>

<p>OpenLayers 3:</p>

<div id="ol3map" style="height: 500px; width: 700px;"></div>
<table>
                <tbody>
<tr>
                    <td><select id="ol3_layerSelection" onchange="ol3_getAttributes(this.value)">
                        <option id="ol3_tile" selected="" value="ol3_tile">Tile layer</option>
                        <option id="ol3_image" value="ol3_image">Image layer</option>
                        <option id="ol3_vector" value="ol3_vector">Vector layer</option>
                        <option id="ol3_heatmap" value="ol3_heatmap">Heatmap layer</option>
                        <option disabled="" id="ol3_group" value="ol3_group">Group layer</option>
                    </select></td>
                    <td>Current pos.: <span id="ol3_pos" style="background-color: #f5a9a9;"></span></td>
                    <td><input onclick="ol3_layerUp()" style="background-color: #f5a9a9;" type="button" value="Up" /></td>
                    <td><input onclick="ol3_layerDown()" style="background-color: #f5a9a9;" type="button" value="Down" /></td>
                    <td><input onclick="ol3_layerTop()" style="background-color: #f5a9a9;" type="button" value="Top" /></td>
                    <td><input onclick="ol3_layerBottom()" style="background-color: #f5a9a9;" type="button" value="Bottom" /></td>
                    <td><input onclick="ol3_layerAdd()" type="button" value="Add" /></td>
                    <td><input onclick="ol3_layerRemove()" type="button" value="Remove" /></td>
                </tr>
</tbody></table>
<table>
                <tbody>
<tr>
                    <td>Opacity(%):</td>
                    <td><input id="ol3_opacity" max="1" min="0" oninput="ol3_changeOpacity(this.value)" step="0.1" type="range" /></td>
                    <td>&nbsp;&nbsp;Visible:&nbsp;&nbsp;</td>
                    <td><input checked="true" id="ol3_visible" onchange="ol3_changeVisible(this.checked)" type="checkbox" /></td>
                </tr>
</tbody></table>
<table>
                <tbody>
<tr>
                    <td>Tile layer:&nbsp;&nbsp;</td>
                    <td><input id="ol3_tilecheck" onchange="ol3_checkbox(this)" type="checkbox" value="ol3_tile" />&nbsp;&nbsp;</td>
                    <td>Image layer:&nbsp;&nbsp;</td>
                    <td><input id="ol3_imagecheck" onchange="ol3_checkbox(this)" type="checkbox" value="ol3_image" />&nbsp;&nbsp;</td>
                    <td>Vector layer:&nbsp;&nbsp;</td>
                    <td><input id="ol3_vectorcheck" onchange="ol3_checkbox(this)" type="checkbox" value="ol3_vector" />&nbsp;&nbsp;</td>
                    <td>Heatmap layer:&nbsp;&nbsp;</td>
                    <td><input id="ol3_heatmapcheck" onchange="ol3_checkbox(this)" type="checkbox" value="ol3_heatmap" />&nbsp;&nbsp;</td>
                </tr>
</tbody></table>
<table>
                <tbody>
<tr>
                    <td><input onclick="ol3_groupLayers()" type="button" value="Group layers" /></td>
                    <td><input onclick="ol3_ungroupLayers()" type="button" value="Ungroup layers" /></td>
                </tr>
</tbody></table>

<p>There are two strange typos in blogger. The vector layer misalignment in OpenLayers 2, and the empty OpenLayers 3 div element. I have no idea about the first one, but to fix the last, simply click one of the red buttons.</p>

<h4 id="checking-layer-presence">Checking layer presence</h4>

<p>The first step in writing functions for layer handling is to check if the layer is present on the map. It has no sense to alter layers which don’t even exist. Running layer management functions on non-existent layers are basically wasting resources, but it can end up in more serious problems, like layer duplication. The first consideration is to store the layers in different variables. This way the layers can be accessed after they’ve been added without extra lines to gather them by various properties.</p>

<p>OpenLayers 2:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">ol2_map</span><span class="p">.</span><span class="nx">getLayersByName</span><span class="p">(</span><span class="nx">ol2_curLayer</span><span class="p">.</span><span class="nx">name</span><span class="p">).</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Do something</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Tell the user, the layer doesn't exist</span>
<span class="p">}</span>
</code></pre>
</div>

<p>OpenLayers 3:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">ol3_checkLayer</span><span class="p">(</span><span class="nx">layer</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">ol3_map</span><span class="p">.</span><span class="nx">getLayers</span><span class="p">().</span><span class="nx">getLength</span><span class="p">();</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">ol3_map</span><span class="p">.</span><span class="nx">getLayers</span><span class="p">().</span><span class="nx">getArray</span><span class="p">()[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="nx">layer</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//check if layer exists</span>
            <span class="nx">res</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">//if exists, return true</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">ol3_checkLayer</span><span class="p">(</span><span class="nx">ol3_curLayer</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// Do something</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Tell the user, the layer doesn't exist</span>
<span class="p">}</span>
</code></pre>
</div>

<p>In OpenLayers 2, the checking can be done with a simple one-liner. The <code class="highlighter-rouge">getLayersByName(name)</code> method returns an array of layers with the name of the input string. This only works if every layer has a unique name. If the layers have another unique identifier in a different property, this can be done with the <code class="highlighter-rouge">getLayersBy(property, value)</code> method.</p>

<p>In OpenLayers 3, there isn’t any method to check if a layer is present in the current composition. However, it has one to provide all layers in an <code class="highlighter-rouge">ol.Collection</code> object. You can easily iterate through this object and check if the provided layer matches any of the returned layers. Watch out for the programming style. I didn’t write the function in the <code class="highlighter-rouge">ol.Map</code> object’s prototype, so you have to hard code the <code class="highlighter-rouge">ol.Map</code>’s variable in the function. If requested, I will write a post about creating functions in prototype.</p>

<h4 id="adding-and-removing-layers">Adding and removing layers</h4>

<p>The most essential control in layer management is the capability of adding and removing layers. Every Web GIS environment offer some functions to this task, you just have to utilize them in your code, so you can create a dynamic application. These functions are one-liners in both of the libraries, you just have to provide the constructed layer objects to them (preferably in variable form for later operations). The only difference is, that OpenLayers 2 provides a bulk add function (<code class="highlighter-rouge">OpenLayers.Map.addLayers([layer1, layer2, etc.]</code>), which requests an array of layer objects. Don’t forget: you should only add layers to the composition which aren’t present and remove the ones which aren’t already removed. For this reason, I will include the checking method into the examples.</p>

<p>OpenLayers 2:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">ol2_layerAdd</span><span class="p">(</span><span class="nx">ol2_curLayer</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">ol2_map</span><span class="p">.</span><span class="nx">getLayersByName</span><span class="p">(</span><span class="nx">ol2_curLayer</span><span class="p">.</span><span class="nx">name</span><span class="p">).</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ol2_map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">ol2_curLayer</span><span class="p">);</span>
        <span class="c1">// Success, tell the user about it</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Layer already added</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">ol2_layerRemove</span><span class="p">(</span><span class="nx">ol2_curLayer</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">ol2_map</span><span class="p">.</span><span class="nx">getLayersByName</span><span class="p">(</span><span class="nx">ol2_curLayer</span><span class="p">.</span><span class="nx">name</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ol2_map</span><span class="p">.</span><span class="nx">removeLayer</span><span class="p">(</span><span class="nx">ol2_curLayer</span><span class="p">);</span>
        <span class="c1">// Success, tell the user about it</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Layer isn't present in the composition</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>OpenLayers 3:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">ol3_layerAdd</span><span class="p">(</span><span class="nx">ol3_curLayer</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">ol3_checkLayer</span><span class="p">(</span><span class="nx">ol3_curLayer</span><span class="p">)</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ol3_map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">ol3_curLayer</span><span class="p">);</span>
        <span class="c1">// Success, tell the user about it</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Layer already added</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">ol3_layerRemove</span><span class="p">(</span><span class="nx">ol3_curLayer</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">ol3_checkLayer</span><span class="p">(</span><span class="nx">ol3_curLayer</span><span class="p">)</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ol3_map</span><span class="p">.</span><span class="nx">removeLayer</span><span class="p">(</span><span class="nx">ol3_curLayer</span><span class="p">);</span>
        <span class="c1">// Success, tell the user about it</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Layer isn't present in the composition</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<h4 id="changing-layer-order">Changing layer order</h4>

<p>When changing the ordering of the layers, you are changing the z index of the layer elements. In theory, you can change the z indexing outside of the framework, however this is often not a good practice. OpenLayers libraries keep track of the z index, and have internal support for changing them. You can change the z index in HTML code, but you can easily end up in conflicts and malfunctions (e.g. you would like to edit a vector layer, which is indexed to the top outside of the library, and the application says, you can’t do so, because internally, it is indexed in the middle).</p>

<p>OpenLayers 2 provides direct functions to change layer order. You can raise and lower layers. You can also define the index of a layer manually, which is handy if you want to set the current layer on the top or the bottom of the stack.</p>

<p>In OpenLayers 3, you have to manually rearrange the array of layers in the composition. You can easily write functions to achieve this, just be sure to do this consequently and keep track of the other members of the array while changing one. There are built-in functions for array manipulation in JavaScript, like <code class="highlighter-rouge">push()</code> and <code class="highlighter-rouge">splice()</code>. You also have to update the view after each modification with <code class="highlighter-rouge">ol.Map.updateSize()</code>.</p>

<p>OpenLayers 2:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">ol2_layerUp</span><span class="p">(</span><span class="nx">ol2_curLayer</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">ol2_map</span><span class="p">.</span><span class="nx">getLayersByName</span><span class="p">(</span><span class="nx">ol2_curLayer</span><span class="p">.</span><span class="nx">name</span><span class="p">).</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ol2_map</span><span class="p">.</span><span class="nx">raiseLayer</span><span class="p">(</span><span class="nx">ol2_curLayer</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">ol2_layerDown</span><span class="p">(</span><span class="nx">ol2_curLayer</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">ol2_map</span><span class="p">.</span><span class="nx">getLayersByName</span><span class="p">(</span><span class="nx">ol2_curLayer</span><span class="p">.</span><span class="nx">name</span><span class="p">).</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ol2_map</span><span class="p">.</span><span class="nx">raiseLayer</span><span class="p">(</span><span class="nx">ol2_curLayer</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">ol2_layerTop</span><span class="p">(</span><span class="nx">ol2_curLayer</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">ol2_map</span><span class="p">.</span><span class="nx">getLayersByName</span><span class="p">(</span><span class="nx">ol2_curLayer</span><span class="p">.</span><span class="nx">name</span><span class="p">).</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">lastIndex</span> <span class="o">=</span> <span class="nx">ol2_map</span><span class="p">.</span><span class="nx">getNumLayers</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="nx">ol2_map</span><span class="p">.</span><span class="nx">setLayerIndex</span><span class="p">(</span><span class="nx">ol2_curLayer</span><span class="p">,</span> <span class="nx">lastIndex</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">ol2_layerBottom</span><span class="p">(</span><span class="nx">ol2_curLayer</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">ol2_map</span><span class="p">.</span><span class="nx">getLayersByName</span><span class="p">(</span><span class="nx">ol2_curLayer</span><span class="p">.</span><span class="nx">name</span><span class="p">).</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ol2_map</span><span class="p">.</span><span class="nx">setLayerIndex</span><span class="p">(</span><span class="nx">ol2_curLayer</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>OpenLayers 3:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">ol3_getLayerIndex</span><span class="p">(</span><span class="nx">layer</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">ol3_map</span><span class="p">.</span><span class="nx">getLayers</span><span class="p">().</span><span class="nx">getLength</span><span class="p">();</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">ol3_map</span><span class="p">.</span><span class="nx">getLayers</span><span class="p">().</span><span class="nx">getArray</span><span class="p">()[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="nx">layer</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//check if layer exists</span>
            <span class="nx">res</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span> <span class="c1">//if exists, return index</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">ol3_layerUp</span><span class="p">(</span><span class="nx">ol3_curLayer</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">ol3_getLayerIndex</span><span class="p">(</span><span class="nx">ol3_curLayer</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="o">!=</span> <span class="kc">false</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nx">ol3_map</span><span class="p">.</span><span class="nx">getLayers</span><span class="p">().</span><span class="nx">getLength</span><span class="p">())</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">ol3_map</span><span class="p">.</span><span class="nx">getLayers</span><span class="p">().</span><span class="nx">getArray</span><span class="p">()[</span><span class="nx">e</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
        <span class="nx">ol3_map</span><span class="p">.</span><span class="nx">getLayers</span><span class="p">().</span><span class="nx">getArray</span><span class="p">()[</span><span class="nx">e</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">ol3_curLayer</span><span class="p">;</span>
        <span class="nx">ol3_map</span><span class="p">.</span><span class="nx">getLayers</span><span class="p">().</span><span class="nx">getArray</span><span class="p">()[</span><span class="nx">e</span><span class="p">]</span> <span class="o">=</span> <span class="nx">f</span><span class="p">;</span>
        <span class="nx">ol3_map</span><span class="p">.</span><span class="nx">updateSize</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">ol3_layerDown</span><span class="p">(</span><span class="nx">ol3_curLayer</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">ol3_getLayerIndex</span><span class="p">(</span><span class="nx">ol3_curLayer</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="o">!=</span> <span class="kc">false</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">ol3_map</span><span class="p">.</span><span class="nx">getLayers</span><span class="p">().</span><span class="nx">getArray</span><span class="p">()[</span><span class="nx">e</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
        <span class="nx">ol3_map</span><span class="p">.</span><span class="nx">getLayers</span><span class="p">().</span><span class="nx">getArray</span><span class="p">()[</span><span class="nx">e</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">ol3_curLayer</span><span class="p">;</span>
        <span class="nx">ol3_map</span><span class="p">.</span><span class="nx">getLayers</span><span class="p">().</span><span class="nx">getArray</span><span class="p">()[</span><span class="nx">e</span><span class="p">]</span> <span class="o">=</span> <span class="nx">f</span><span class="p">;</span>
        <span class="nx">ol3_map</span><span class="p">.</span><span class="nx">updateSize</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">ol3_layerTop</span><span class="p">(</span><span class="nx">ol3_curLayer</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">ol3_getLayerIndex</span><span class="p">(</span><span class="nx">ol3_curLayer</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="o">!=</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ol3_map</span><span class="p">.</span><span class="nx">getLayers</span><span class="p">().</span><span class="nx">getArray</span><span class="p">().</span><span class="nx">splice</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
        <span class="nx">ol3_map</span><span class="p">.</span><span class="nx">getLayers</span><span class="p">().</span><span class="nx">getArray</span><span class="p">().</span><span class="nx">push</span><span class="p">(</span><span class="nx">ol3_curLayer</span><span class="p">);</span>
        <span class="nx">ol3_map</span><span class="p">.</span><span class="nx">updateSize</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">ol3_layerBottom</span><span class="p">(</span><span class="nx">ol3_curLayer</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">ol3_getLayerIndex</span><span class="p">(</span><span class="nx">ol3_curLayer</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="o">!=</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ol3_map</span><span class="p">.</span><span class="nx">getLayers</span><span class="p">().</span><span class="nx">getArray</span><span class="p">().</span><span class="nx">splice</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
        <span class="nx">ol3_map</span><span class="p">.</span><span class="nx">getLayers</span><span class="p">().</span><span class="nx">getArray</span><span class="p">().</span><span class="nx">splice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">ol3_curLayer</span><span class="p">);</span>
        <span class="nx">ol3_map</span><span class="p">.</span><span class="nx">updateSize</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Note that in the OpenLayers 3 part of the example code, I have used two methods to rearrange layers. For the layer up and layer down functions, I simply swapped the index of the two corresponding layers. In the top and bottom functions, I have used the <code class="highlighter-rouge">splice()</code> and <code class="highlighter-rouge">push()</code> methods. The <code class="highlighter-rouge">ol3_getLayerIndex()</code> function is similar to the previous <code class="highlighter-rouge">ol3_checkLayer()</code> function, only it returns the index of the matching layer instead of true.</p>

<h4 id="setting-opacity">Setting opacity</h4>

<p>I’m not entirely sure if this simple function deserves an entire subsection, but it is a major consideration in a Web GIS application, to provide an opacity control. Web GIS frameworks based on mapping GUIs, like GeoExt provide controls for this. However, in OpenLayers, there aren’t such controls, so you have to write it manually. There are plenty of ways to implement this control in your code, like registering an event, or just creating a slider with an <code class="highlighter-rouge">onchange</code> attribute, so I just show how to change opacity on a layer. Note that opacity values are between 0 and 1.</p>

<p>OpenLayers 2:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">ol2_changeOpacity</span><span class="p">(</span><span class="nx">ol2_curLayer</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">ol2_map</span><span class="p">.</span><span class="nx">getLayersByName</span><span class="p">(</span><span class="nx">ol2_curLayer</span><span class="p">.</span><span class="nx">name</span><span class="p">).</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ol2_curLayer</span><span class="p">.</span><span class="nx">setOpacity</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>OpenLayers 3:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">ol3_changeOpacity</span><span class="p">(</span><span class="nx">ol3_curLayer</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">ol3_getLayerIndex</span><span class="p">(</span><span class="nx">ol3_curLayer</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ol3_curLayer</span><span class="p">.</span><span class="nx">setOpacity</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<h4 id="openlayers-3-specific-functions">OpenLayers 3 specific functions</h4>

<p>OpenLayers 3 has some major lack in layer management in this early time of development. It doesn’t provide a layer switcher control, so you have to change layer visibility with a function. The <code class="highlighter-rouge">value</code> property must be boolean.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">ol3_changeVisible</span><span class="p">(</span><span class="nx">ol3_curlayer</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ol3_curLayer</span><span class="p">.</span><span class="nx">setVisible</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<p>As I mentioned in the previous post, OpenLayers 3 provides a new layer class, <code class="highlighter-rouge">ol.layer.Group</code>. You can group and ungroup any stack of layers dynamically. For this, you only have to provide an <code class="highlighter-rouge">ol.Collection</code> object with the layers in it. To empty a layer group, just provide an empty collection object. In this case the layers parameter must be an array, and it have to contain layer objects.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">ol3_groupLayers</span><span class="p">(</span><span class="nx">ol3_group</span><span class="p">,</span> <span class="nx">layers</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">layers</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//Check if the array have members</span>
        <span class="nx">ol3_group</span><span class="p">.</span><span class="nx">setLayers</span><span class="p">(</span><span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Collection</span><span class="p">(</span><span class="nx">layers</span><span class="p">));</span>
        <span class="nx">ol3_map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">ol3_group</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">ol3_ungroupLayers</span><span class="p">(</span><span class="nx">ol3_group</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">ol3_group</span><span class="p">.</span><span class="nx">getLayers</span><span class="p">().</span><span class="nx">getLength</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//Check if the group layer contains layers</span>
        <span class="nx">ol3_map</span><span class="p">.</span><span class="nx">removeLayer</span><span class="p">(</span><span class="nx">ol3_group</span><span class="p">);</span> <span class="c1">//Remove the layer group from the map</span>
        <span class="nx">ol3_group</span><span class="p">.</span><span class="nx">setLayers</span><span class="p">(</span><span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Collection</span><span class="p">());</span> <span class="c1">//Empty the layer group</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<script src="/assets/js/OpenLayers/OpenLayers.js" type="text/javascript"></script>

<script src="/assets/js/ol-v3.0.0.js" type="text/javascript"></script>

<script src="/assets/js/openlayers-layer-management.js" type="text/javascript"></script>


  </article>

  
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname  = 'gaborfarkas-github-io';
      var disqus_identifier = '/blog/2014/openlayers-layer-management';
      var disqus_title      = "OpenLayers layer management";
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  

</div>

      </div>
    </div>

    <footer>

  <div class="wrapper">
    &copy; Copyright 2017 Gábor Farkas.
    Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank">GitHub Pages</a>.

    
  </div>

</footer>


    <!-- Load jQuery -->
<script src="//code.jquery.com/jquery-1.12.4.min.js"></script>

<!-- Load Common JS -->
<script src="/assets/js/common.js"></script>


<!-- Load KaTeX -->
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js"></script>
<script src="/assets/js/katex.js"></script>




<!-- Include custom icon fonts -->
<link rel="stylesheet" href="/assets/css/font-awesome.min.css">
<link rel="stylesheet" href="/assets/css/academicons.min.css">

<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-XXXXXXXX-X', 'auto');
ga('send', 'pageview');
</script>


  </body>

</html>
