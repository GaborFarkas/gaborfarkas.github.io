<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Gábor Farkas | GeoJSON Lite</title>
  <meta name="description" content="My personal site.">

  <link rel="shortcut icon" href="https://gaborfarkas.github.io/assets/img/favicon.ico">

  <link rel="stylesheet" href="https://gaborfarkas.github.io/assets/css/main.css">
  <link rel="canonical" href="https://gaborfarkas.github.io/blog/2016/geojson-lite/">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    
    <span class="site-title">
        
        Gábor Farkas
    </span>
    

    <nav class="site-nav">

      <div class="trigger">
        <!-- About -->
        <a class="page-link" href="https://gaborfarkas.github.io/">about</a>

        <!-- Blog -->
        <a class="page-link" href="https://gaborfarkas.github.io/blog/">blog</a>

        <!-- Pages -->
        
          
        
          
            <a class="page-link" href="https://gaborfarkas.github.io/cv/">CV</a>
          
        
          
        
          
        
          
            <a class="page-link" href="https://gaborfarkas.github.io/publications/">publications</a>
          
        
          
            <a class="page-link" href="https://gaborfarkas.github.io/stuff/">stuff</a>
          
        
          
        
          
        
          
        

      </div>
    </nav>

  </div>

</header>



    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">GeoJSON Lite</h1>
    <p class="post-meta">February 7, 2016</p>
  </header>

  <article class="post-content">
    <p>GeoJSON is one of the most widely used vector formats in the web mapping, and WebGIS world. It has a nice, robust way of storing various feature types along with their coordinates, and properties. On the top of that, it can be parsed as an ordinary JSON object, thus JavaScript has a native support for it. This is the format supported by every client side web mapping library (I have come across so far), thus it is the perfect candidate for testing the feature parsing, and rendering performance of them. However, what is the best way of generating random features in arbitrary numbers? There were two paths I seriously considered:</p>

<ul>
  <li>Use an existing client side GeoJSON library. There is the NPM package <a href="https://www.npmjs.com/package/geojson">geojson</a>, which could have been a potential candidate. However, writing a wrapper around it, which have a random generator seemed to be as troublesome as writing a new library for this purpose.</li>
  <li>Generate the features on the server side. There is the Python package <a href="https://pypi.python.org/pypi/geojson/">geojson</a>, which is perfect, as it has a random feature generator. The downside of this path is the involvement of a server. I would rather have a library, which can generate the features on the client side, thus showcasing the results is not bound to a specific server.</li>
</ul>

<p>By measuring the benefits, and disadvantages of using one of the two methods, I quickly decided to write my own library for this purpose. It is dead simple, small (11.6 KB compiled), and capable of validating GeoJSON objects (based on the official <a href="http://geojson.org/geojson-spec.html">specs</a>), and generating random ones. As a consequence of its small size, and limited capabilities, it is called <a href="https://github.com/GaborFarkas/geojson_lite">GeoJSON Lite</a>.</p>

<h3 id="architectural-considerations">Architectural considerations</h3>

<h4 id="geojson-objects">GeoJSON objects</h4>

<p>The first, and most important consideration was about the GeoJSON objects. They should be as lightweight as possible, but still functional. Thus, every GeoJSON constructors store their properties in the constructed objects directly. They have two methods: <code class="highlighter-rouge">isValid</code>, and <code class="highlighter-rouge">stringify</code>. However, those methods are stored in their prototype chains, or their parents’ prototype chains.</p>

<h4 id="inheritance">Inheritance</h4>

<p>GeoJSON Lite uses the Closure Library style pseudoclassical inheritance model. The child’s prototype gets entirely replaced by the parent’s prototype, and its constructor function gets restored in the end.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="c1">//Helper function for maintaining class inheritance. Adapted from goog.inherits, from Google's Closure Library.</span>
<span class="nx">gjl</span><span class="p">.</span><span class="nx">inherits</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">child</span><span class="p">)</span> <span class="p">{</span>
 <span class="kd">var</span> <span class="nx">Temp</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{};</span>
 <span class="nx">Temp</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
 <span class="nx">child</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Temp</span><span class="p">();</span>
 <span class="nx">child</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">=</span> <span class="nx">child</span><span class="p">;</span>
<span class="p">};</span>
</code></pre>
</div>

<h4 id="factory-constructor">Factory constructor</h4>

<p>There are two kind of constructors in the library: GeoJSON object constructors, and a factory constructor. The factory constructor is the opposite of the GeoJSON object constructor. It has one purpose: it must generate all kind of valid GeoJSON objects (expect CRS, BBOX, and other misc objects). It can be as bloated as it must be in order to achieve that task. It stores a bunch of parameters, has a bunch of functions on its prototype chain, etc. etc.</p>

<h4 id="nodejs">Node.js</h4>

<p>The library uses Node.js, and NPM for compiling, unit testing, and generating API documentation. It uses the Closure Compiler’s advanced compilation algorithm, however it does not use the Closure Library. This comes with some naming conventions. Closure Compiler only exports associative assignments from a native JavaScript code.</p>

<p>Furthermore, there is one method, which uses a browser-only feature. With that, Node.js support is not planned, as the library would break in some circumstances (link validation in a CRS object). It is still possible to load the library in Node.js, however we must come around the <em>window is not defined</em> problem. One method is adding a <code class="highlighter-rouge">window</code> object to the global scope as the global scope:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">GLOBAL</span><span class="p">.</span><span class="nb">window</span> <span class="o">=</span> <span class="nx">GLOBAL</span><span class="p">;</span>
</code></pre>
</div>

<h4 id="development">Development</h4>

<p>Developing the library takes some extra hassle, however I think that is the price we can pay for a smooth development process. Every third-party dependency can be installed with Node.js’s package manager NPM. There aren’t much, Closure Compiler for compiling the code, Jasmine for unit testing, and JSDoc 3 for generating documentation. To start development, you just have to clone into the library’s repository, and install the dependencies (assuming you have Node.js, and git installed, and using a Unix system):</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>git clone https://github.com/GaborFarkas/geojson_lite.git
<span class="nb">cd </span>geojson_lite/
npm install
</code></pre>
</div>

<h4 id="modifying-the-code">Modifying the code</h4>

<p>As in every development process, the key step is modifying, or extending the code. I won’t write any guidelines, or considerations here, they can be found in the project’s page. However, there is one rule, you must follow, if you wouldn’t want Closure Compiler to mess up your part of the code. If you want to export something, you must have a reference to it in an associative way.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="c1">//var gjl = {};</span>
<span class="c1">//window['gjl'] = gjl;</span>

<span class="nx">gjl</span><span class="p">.</span><span class="nx">myConstructor</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">number</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">number</span> <span class="o">=</span> <span class="nx">number</span><span class="p">;</span>
<span class="p">};</span>
<span class="nx">gjl</span><span class="p">[</span><span class="s1">'myConstructor'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">gjl</span><span class="p">.</span><span class="nx">myConstructor</span><span class="p">;</span>

<span class="c1">//Compiled code will look like something like this (with significantly more "a"-s):</span>
<span class="c1">//var a={};window.gjl=a;a.b=function(c){this.d=c;};a.myConstructor=a.b;</span>
</code></pre>
</div>

<h4 id="compiling-the-code">Compiling the code</h4>

<p>For compiling the code, you just have to run the utility script <strong>compile.js</strong> in the root folder. It compiles <strong>src/gjl.js</strong> to <strong>build/gjl.js</strong>.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>node compile.js
</code></pre>
</div>

<h4 id="testing-the-code">Testing the code</h4>

<p>There are two main reasons to run tests: avoiding regressions, and testing new features. I wrote the code with great care, however I cannot guarantee it doesn’t have any hidden bugs. If you modify the code, you can easily uncover one, creating a regression. The easiest way avoiding such unexpected consequences, is running the test suite:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>npm <span class="nb">test</span>
</code></pre>
</div>

<p>It runs Jasmine (specifically jasmine-node) on the spec folder’s content. If you’re extending the original code, Travis CI will take care of testing, however if you’re doing local modifications, you should run the test suite after compiling the code. Creating additional tests for newly implemented features are also useful. You can read about creating tests with Jasmine <a href="http://2ality.com/2011/10/jasmine.html">here</a>.</p>

<p>The next post will give some practical advices for using GeoJSON Lite. Until then, here are some useful links related to the project:</p>

<ul>
  <li><a href="https://github.com/GaborFarkas/geojson_lite">GeoJSON Lite on GitHub</a></li>
  <li><a href="https://www.npmjs.com/package/geojson_lite">GeoJSON Lite on NPM</a></li>
  <li><a href="https://gaborfarkas.github.io/geojson_lite/v1.0.1/api/">GeoJSON Lite API Documentation</a></li>
</ul>


  </article>

  
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname  = 'gaborfarkas-github-io';
      var disqus_identifier = '/blog/2016/geojson-lite';
      var disqus_title      = "GeoJSON Lite";
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  

</div>

      </div>
    </div>

    <footer>

  <div class="wrapper">
    &copy; Copyright 2019 Gábor Farkas.
    Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank">GitHub Pages</a>.

    
  </div>

</footer>


    <!-- Load jQuery -->
<script src="//code.jquery.com/jquery-1.12.4.min.js"></script>

<!-- Load Common JS -->
<script src="https://gaborfarkas.github.io/assets/js/common.js"></script>


<!-- Load KaTeX -->
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js"></script>
<script src="https://gaborfarkas.github.io/assets/js/katex.js"></script>




<!-- Include custom icon fonts -->
<link rel="stylesheet" href="https://gaborfarkas.github.io/assets/css/font-awesome.min.css">
<link rel="stylesheet" href="https://gaborfarkas.github.io/assets/css/academicons.min.css">

<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-107151753-1', 'auto');
  ga('send', 'pageview');

</script>


  </body>

</html>
